<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/addons/p5.sound.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../static/style.css">
    <title>GateKeeper - Main</title>
    <meta charset="utf-8" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Bangers&family=Belanosima:wght@400;600;700&family=Modak&family=Rampart+One&display=swap" rel="stylesheet">
    <!-- Link the font icons from font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  </head>
  <body>
    <button id="options-btn">
      <i class="fa fa-cog"></i>
  </button>
  
  <!-- Options Menu (Initially Hidden) -->
  <div id="options-menu">
         <button class="exit-btn" id="close-options">
              <i class="fa-solid fa-xmark"></i>
        </button>
        <div class="options-title">
              <p>Settings</p>
        </div>
          <div class="volume-container">
              <div class="volume-icon">
                  <i class="fa-solid fa-volume-off"></i>
              </div>
              <div class="volume-slider">
                  <input type="range" id="volume-slider" min="0" max="100" value="50">
              </div>
          </div>
  
          <div class="music-container">
              <div class="music-icon">
                  <i class="fa-solid fa-music"></i>
              </div>
              <div class="music-slider">
                  <input type="range" id="music-slider" min="0" max="100" value="50">
              </div>
          </div>
  
      <!-- Bottom Section with Back Button -->
      <div class="bottom-options-section">
          <button id="back-to-main">Home</button>
      </div>
  </div>
  <section>
    <div class="popup-overlay" id="popup" onclick="closePopup(event)">
      <div class="win-popup" onclick="event.stopPropagation()">
        <div class="top-win-section">
          <div class="win-title">
            <p>You win!</p>
          </div>
        </div>
  
        <!-- Next Level Button -->
        <button class="win-button" onclick="loadNextLevel()">Next Level</button>
        <button class="win-button" onclick="closePopupWin()">Stay here</button>
        <button class="win-button" onclick="window.location.href='./index.html'">Bring Me Home</button>
      </div>
    </div>
  </section>

  <!-- Slide-out Gate Info Panel -->
  <div id="gateInfoPanel" class="side-panel">
    <button id="togglePanelBtn">â˜°</button>
    <div id="gateInfoContent" class="panel-content">
      <h3>Level Instructions</h3>
      <p id="levelDesc"></p>
      <h3>Gate Descriptions</h3>
      <ul id="gateList"></ul>
    </div>
  </div>

  <!-- Gate Description Popup -->
  <div id="gateDescPopup" class="desc-popup" style="display: none;">
    <div class="desc-content" id="descContent">
      <p id="descText"></p>
    </div>
  </div>


    <main>
      <!-- Added background to canvas -->
      <section id="">
        <h1 id="Level-Name" style="padding-left: 1%;"></h1>
        
      </section>

      <div class="description-border">
        <p id="Description" style="visibility: hidden;"></p>
      </div>
      

      <section>

        <style>
            #bot-wrapper {
                position: fixed;
                bottom: 2%;
                left: 1%;
                display: inline-block;
            }
        
            #bot {
                width: 240px;
                height: 187.5px;
                cursor: pointer;
                transition: transform 0.3s ease;
                background-image: url('../static/images/bot1.png');
                background-size: auto 100%;
                background-color: none;
            }
        
            #bot.animated {
                background-image: url('../static/images/botmove-Sheet.png');
                background-repeat: steps(14);
                animation: spriteAnimation 2s steps(14) 2;
            }
        
            @keyframes spriteAnimation {
                100% { background-position: -3360px 0; }
            }
        
            #bot-text {
                position: absolute;
                background-color: white;
                padding: 10px 15px;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
                left: 250px;
                top: 100px; /* Adjusted to lower the text box */
                display: none;
                border: 1px solid #ccc;
            }
        
            #bot-text-inner {
                color: black;
                background-color: white;
                white-space: nowrap;
                overflow: hidden;
            }
        
            .typewriter {
                animation: typing 1.5s steps(40, end) forwards; /* Faster typing */
            }
        
            @keyframes typing {
                from { width: 0; }
                to { width: 100%; }
            }
        </style>
        
        <div id="bot-wrapper">
            <div id="bot"></div>
            <div id="bot-text"><div id="bot-text-inner"></div></div>
        </div>
        
        <script>
            const bot = document.getElementById('bot');
            const botText = document.getElementById('bot-text');
            const botTextInner = document.getElementById('bot-text-inner');
            let isAnimating = false;
            const dialogue = "Would you like a hint? Click the tab on the left to view the description!";
        
            bot.addEventListener('click', () => {
              if (!isAnimating) {
                isAnimating = true;

                bot.style.transform = 'scale(1.1)';

                setTimeout(() => {
                  bot.style.transform = 'scale(1)';
                  bot.classList.add('animated');

                  // Ensure the text box is fully reset
                  botTextInner.style.animation = 'none';
                  botTextInner.offsetWidth; // Force reflow
                  botTextInner.textContent = ''; // Clear previous text
                  botText.style.display = 'block'; // Ensure visibility

                  setTimeout(() => {
                    // Set new text and reapply animation
                    botTextInner.textContent = dialogue;
                    botTextInner.style.animation = `typing 1.5s steps(40, end) forwards`;

                    setTimeout(() => {
                      // Ensure the text remains after animation
                      botTextInner.style.width = botTextInner.scrollWidth + 'px';
                      botTextInner.style.animation = 'none'; // Stop further animation

                      setTimeout(() => {
                        botText.style.display = 'none';
                        botTextInner.textContent = ''; // Clear text for next cycle
                        isAnimating = false;
                      }, 2000); // Keeps text visible before hiding
                    }, 1500); // Wait for typing animation to complete

                  }, 50); // Slight delay to ensure reset completes

                  bot.addEventListener('animationend', function animationEndHandler() {
                    bot.classList.remove('animated');
                    bot.removeEventListener('animationend', animationEndHandler);
                  });

                }, 300);
              }
            });
        </script>

      </section>





    </main>
    <script src="../static/spatialHash.js"></script>
    
    <script src="../static/NodeClass.js"></script>

    <script src="../static/drawGates.js"></script>
    
    <script src="../static/GameSounds.js"></script>
    <script src="../static/GateKeeperObjects.js"></script>
    <script src="../static/sound_effect.js"></script>
    <script src="../static/options.js"></script>
    <script src="../static/getInfoPanel.js"></script>
  </body>
</html>